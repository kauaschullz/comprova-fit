<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ComprovaFIT</title>
  <style>
    :root {
      --green: #00b050;
      --dark: #111;
      --gray: #666;
      --light-gray: #f5f5f5;
      --border: #0f0f0f;
      --max-width: 430px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: linear-gradient(180deg, #f8fff8 0%, #eef7ef 40%, #ffffff 100%);
      color: var(--dark);
      display: flex;
      justify-content: center;
      padding: 20px 12px 80px;
    }

    .app-shell {
      width: 100%;
      max-width: var(--max-width);
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      position: relative;
      min-height: 100vh;
    }

    header {
      padding: 20px 18px 12px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }

    .logo-circle {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: var(--green);
      display: grid;
      place-items: center;
      color: white;
      font-size: 26px;
      font-weight: 700;
      box-shadow: 0 8px 18px rgba(0, 176, 80, 0.35);
    }

    .login-hero {
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at 20% 20%, rgba(0, 176, 80, 0.16), transparent 48%),
        linear-gradient(135deg, #f7fff9 0%, #e6f6ea 45%, #fdfdfd 100%);
      padding: 26px 18px 20px;
      border-radius: 0 0 28px 28px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }

    .hero-tagline {
      display: grid;
      gap: 6px;
      margin-top: 10px;
    }

    .hero-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pill-light {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0, 176, 80, 0.08);
      color: var(--dark);
      font-weight: 600;
      font-size: 12px;
      border: 1px solid rgba(0, 176, 80, 0.25);
    }

    .login-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 14px;
    }

    .metric-card {
      background: white;
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.04);
    }

    .metric-card strong {
      display: block;
      font-size: 18px;
    }

    h1, h2, h3 {
      color: var(--dark);
    }

    h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }

    h2 {
      font-size: 24px;
      margin-bottom: 12px;
    }

    p.subtitle {
      color: var(--gray);
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .section {
      display: none;
      padding: 14px 18px 110px;
      min-height: 100vh;
      background: var(--light-gray);
    }

    .section.active {
      display: block;
    }

    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .choice-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 8px 0 16px;
    }

    .choice-item {
      position: relative;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, #f9fff9 0%, #ffffff 100%);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
      cursor: pointer;
      transition: border 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: center;
    }

    .choice-item input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .choice-check {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border: 2px solid rgba(0, 0, 0, 0.15);
      display: grid;
      place-items: center;
      font-size: 12px;
      color: transparent;
      transition: all 0.15s ease;
      background: white;
    }

    .choice-label {
      font-weight: 600;
      color: var(--dark);
      line-height: 1.3;
      font-size: 14px;
    }

    .choice-item.selected {
      border-color: var(--green);
      box-shadow: 0 8px 18px rgba(0, 176, 80, 0.2);
      background: linear-gradient(135deg, #f3fff5 0%, #ffffff 100%);
      transform: translateY(-1px);
    }

    .choice-item.selected .choice-check {
      border-color: var(--green);
      color: var(--green);
      background: rgba(0, 176, 80, 0.08);
      content: '‚úì';
    }

    .mini-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }

    .mini-card {
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 16px;
      padding: 12px;
      background: linear-gradient(145deg, #f8fff8 0%, #ffffff 100%);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .mini-card strong {
      font-size: 15px;
    }

    .progress-dots {
      display: flex;
      gap: 8px;
      margin: 10px 0 16px;
      align-items: center;
    }

    .progress-dots .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #dcdcdc;
    }

    .progress-dots .dot.done {
      background: var(--green);
    }

    .progress-dots .dot.active {
      background: linear-gradient(135deg, var(--green), #1ed883);
      box-shadow: 0 0 0 6px rgba(0, 176, 80, 0.15);
    }

    .divider {
      height: 1px;
      background: rgba(0, 0, 0, 0.05);
      margin: 14px 0;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 16px;
    }

    input, select, textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px 14px;
      font-size: 16px;
      background: #fff;
      outline: none;
      transition: box-shadow 0.2s, transform 0.1s;
    }

    input:focus, select:focus, textarea:focus {
      box-shadow: 0 0 0 3px rgba(0, 176, 80, 0.2);
      transform: translateY(-1px);
    }

    button {
      background: var(--green);
      color: white;
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 14px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      transition: transform 0.15s, box-shadow 0.15s;
    }

    button:active {
      transform: translateY(1px) scale(0.995);
    }

    .btn-secondary {
      background: white;
      color: var(--dark);
    }

    .login-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 4px;
    }

    .card {
      background: #fff;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 16px;
    }

    .pill-btn {
      background: #0f0f0f;
      color: white;
      border-radius: 30px;
      padding: 8px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .search-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      padding: 8px 10px;
      background: #fdfdfd;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 18px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    }

    .search-bar input {
      flex: 1;
      border-radius: 18px;
      background: #f8f8f8;
      border: 1px solid rgba(0, 0, 0, 0.12);
      min-height: 44px;
    }

    .search-btn {
      background: var(--green);
      color: white;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px 14px;
      display: grid;
      place-items: center;
      width: auto;
      min-width: 44px;
      box-shadow: 0 8px 18px rgba(0, 176, 80, 0.25);
      flex-shrink: 0;
    }

    .select-filter {
      margin-bottom: 12px;
    }

    .supplement-item {
      display: grid;
      grid-template-columns: 70px 1fr 40px;
      gap: 12px;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }

    .supplement-item:last-child {
      border-bottom: none;
    }

    .supplement-item img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 16px;
      border: 1px solid rgba(0, 0, 0, 0.08);
    }

    .supplement-info h4 {
      font-size: 16px;
      margin-bottom: 6px;
    }

    .supplement-info p {
      font-size: 13px;
      color: var(--gray);
      line-height: 1.3;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #f7fff9;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 700;
    }

    .badge::before {
      content: '‚Ä¢';
      font-size: 16px;
      line-height: 1;
    }

    .reliability-high { color: #0a8f2f; }
    .reliability-medium { color: #d0a000; }
    .reliability-low { color: #c63d2f; }

    .detail-hero img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 20px;
      margin-bottom: 14px;
    }

    .detail-hero .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 6px;
    }

    .detail-hero h2 {
      margin: 0;
    }

    .detail-section {
      margin-bottom: 16px;
    }

    .detail-section h3 {
      font-size: 18px;
      margin-bottom: 6px;
    }

    .detail-section ul {
      list-style: disc;
      padding-left: 18px;
      color: var(--gray);
      line-height: 1.5;
    }

    .tabs {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      background: #f2f2f2;
      border-radius: 14px;
      margin-bottom: 12px;
      padding: 4px;
      border: 1px solid rgba(0, 0, 0, 0.08);
    }

    .tab-btn {
      border: none;
      background: transparent;
      padding: 10px 0;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
    }

    .tab-btn.active {
      background: white;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
      border: 1px solid var(--border);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .history-item {
      display: grid;
      grid-template-columns: 60px 1fr 40px;
      gap: 10px;
      align-items: center;
      background: #fdfdfd;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 14px;
      padding: 10px;
    }

    .history-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 14px;
    }

    .empty-state {
      text-align: center;
      color: var(--gray);
      border: 1px dashed rgba(0, 0, 0, 0.1);
      padding: 16px;
      border-radius: 14px;
      background: #fff;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--green), #0ed17a);
      display: grid;
      place-items: center;
      color: white;
      font-size: 26px;
      font-weight: 800;
      border: 2px solid var(--border);
      box-shadow: 0 10px 24px rgba(0, 176, 80, 0.25);
    }

    .options-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 14px;
      cursor: pointer;
      background: #fafafa;
    }

    .navbar {
      position: fixed;
      bottom: 12px;
      left: 0;
      right: 0;
      display: none;
      justify-content: center;
      pointer-events: none;
    }

    .navbar.show {
      display: flex;
    }

    .nav-active .section {
      padding-bottom: 160px;
    }

    .navbar .inner {
      width: 100%;
      max-width: var(--max-width);
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 4px;
      background: #0f0f0f;
      color: white;
      padding: 8px;
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }

    .nav-btn {
      border: none;
      background: transparent;
      color: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 6px;
      border-radius: 12px;
      font-size: 13px;
      cursor: pointer;
      position: relative;
      transition: background 0.2s, transform 0.15s;
    }

    .nav-btn.active {
      background: rgba(255, 255, 255, 0.14);
      transform: translateY(-1px);
    }

    .nav-btn.active::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--green);
    }

    .nav-icon {
      font-size: 18px;
    }

    .chat-hero {
      background: linear-gradient(135deg, #f7fff9 0%, #f1f7f2 60%, #ffffff 100%);
      border-radius: 18px;
      padding: 18px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.05);
      margin-bottom: 12px;
    }

    .chat-wrapper {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 60vh;
    }

    .chat-prompts {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    .prompt-chip {
      padding: 8px 12px;
      border-radius: 14px;
      background: #eef7ef;
      border: 1px solid rgba(0, 0, 0, 0.07);
      font-size: 13px;
      cursor: pointer;
    }

    .chat-feed {
      background: #0f0f0f;
      border-radius: 16px;
      padding: 12px;
      color: white;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    .chat-empty {
      color: rgba(255, 255, 255, 0.75);
      font-size: 14px;
      line-height: 1.4;
    }

    .chat-bubble {
      max-width: 90%;
      padding: 12px 14px;
      border-radius: 14px;
      line-height: 1.5;
      font-size: 14px;
      white-space: pre-line;
    }

    .chat-bubble.user {
      align-self: flex-end;
      background: #d2f2dd;
      color: #0b2f15;
      box-shadow: 0 8px 18px rgba(0, 176, 80, 0.25);
    }

    .chat-bubble.bot {
      align-self: flex-start;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .chat-input-row {
      display: flex;
      align-items: center;
      gap: 8px;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 14px;
      padding: 8px 10px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
    }

    .chat-input-row input {
      border: none;
      background: transparent;
      padding: 10px;
      border-radius: 10px;
      font-size: 15px;
      outline: none;
    }

    .chat-send {
      width: 46px;
      height: 46px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--green);
      color: white;
      font-weight: 700;
      display: grid;
      place-items: center;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0, 176, 80, 0.25);
    }

    .chat-meta {
      color: rgba(255, 255, 255, 0.8);
      font-size: 12px;
      margin-bottom: 4px;
    }

    .camera-box {
      background: linear-gradient(180deg, #f7fff9 0%, #ffffff 100%);
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .camera-stage {
      position: relative;
      overflow: hidden;
      border-radius: 16px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      background: #0f0f0f;
      min-height: 260px;
    }

    .camera-overlay {
      position: absolute;
      inset: 12px;
      border: 2px dashed rgba(255, 255, 255, 0.5);
      border-radius: 18px;
      pointer-events: none;
      box-shadow: 0 0 0 999px rgba(0, 0, 0, 0.25) inset;
    }

    .camera-overlay::after {
      content: '';
      position: absolute;
      inset: 18%;
      border: 1px solid rgba(0, 176, 80, 0.6);
      border-radius: 14px;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.4);
    }

    .camera-stage video,
    .camera-stage canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .camera-stage canvas {
      display: none;
      background: #000;
    }

    .camera-stage.flash::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.55);
      animation: flash 320ms ease forwards;
      pointer-events: none;
    }

    @keyframes flash {
      from { opacity: 0.7; }
      to { opacity: 0; }
    }

    .capture-feedback {
      color: #0a8f2f;
      font-weight: 700;
    }

    .camera-status {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--gray);
      font-size: 14px;
    }

    .camera-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .camera-actions button {
      flex: 1;
    }

    .capture-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .capture-card {
      background: #fff;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .capture-thumb {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: #f5f5f5;
    }

    .capture-meta {
      font-size: 12px;
      color: var(--gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    @media (min-width: 900px) {
      body {
        background: radial-gradient(circle at 20% 20%, rgba(0, 176, 80, 0.12), transparent 30%),
          radial-gradient(circle at 80% 10%, rgba(0, 176, 80, 0.1), transparent 26%),
          #f5f7f5;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Login -->
    <section id="login" class="section active">
      <div class="login-hero">
        <div class="logo">
          <div class="logo-circle">üí™</div>
          <div>
            <h1>ComprovaFIT</h1>
            <p class="subtitle">Compre apenas os suplementos que voc√™ precisa</p>
          </div>
        </div>
        <div class="hero-tagline">
          <strong>Guia confi√°vel em formato de app</strong>
          <div class="hero-pills">
            <span class="pill-light">Base cient√≠fica</span>
            <span class="pill-light">Solu√ß√£o de d√∫vidas</span>
            <span class="pill-light">Recomenda√ß√µes r√°pidas</span>
          </div>
        </div>
      </div>
      <div class="card" style="margin-top:14px;">
        <p class="subtitle">Acesse para receber recomenda√ß√µes com base cient√≠fica e personalizadas para seus objetivos.</p>
        <div class="input-group">
          <input id="login-email" type="email" placeholder="Email" />
          <input id="login-password" type="password" placeholder="Senha" />
        </div>
        <div class="login-actions">
          <button id="btn-login">Entrar</button>
          <button class="btn-secondary" id="btn-guest">Explorar sem criar conta</button>
        </div>
      </div>
    </section>

    <!-- Conhecer usu√°rio -->
    <section id="persona" class="section">
      <div class="login-hero" style="padding:22px 18px 18px;border-radius:18px;">
        <div class="section-title-row" style="align-items:flex-start;">
          <div>
            <h2 style="margin-bottom:4px;">Queremos te conhecer</h2>
            <p class="subtitle" style="margin-bottom:8px;">Escolha o que faz sentido para voc√™. Em poucos toques deixamos as recomenda√ß√µes sob medida.</p>
          </div>
          <div class="logo-circle" style="width:44px;height:44px;font-size:20px;">‚ú®</div>
        </div>
      </div>
      <div class="card" style="margin-top:14px;">
        <p><strong>Objetivo principal</strong></p>
        <div class="choice-grid" id="chip-objetivo"></div>
        <p><strong>Prefer√™ncias</strong></p>
        <div class="choice-grid" id="chip-preferencias"></div>
        <p><strong>Restri√ß√µes</strong></p>
        <div class="choice-grid" id="chip-restricoes"></div>
        <button id="btn-go-quiz">Continuar e detalhar perfil</button>
      </div>
    </section>

    <!-- Question√°rio -->
    <section id="quiz" class="section">
      <header>
        <h2>Nos conte mais sobre voc√™</h2>
        <p class="subtitle">Personalize suas recomenda√ß√µes com base no seu perfil.</p>
      </header>
      <div class="progress-dots" aria-label="Etapa 3 de 3">
        <span class="dot done"></span>
        <span class="dot done"></span>
        <span class="dot active"></span>
      </div>
      <div class="card">
        <div class="input-group">
          <input id="idade" type="number" placeholder="Idade" />
          <input id="peso" type="number" placeholder="Peso (kg)" />
          <select id="atividade">
            <option value="Sedent√°rio">Sedent√°rio</option>
            <option value="Leve">Leve</option>
            <option value="Moderado" selected>Moderado</option>
            <option value="Intenso">Intenso</option>
          </select>
          <input id="exercicio" type="text" placeholder="Tipo de exerc√≠cio (muscula√ß√£o, corrida...)" />
          <input id="objetivo" type="text" placeholder="Objetivo (massa, desempenho, sa√∫de...)" />
        </div>
        <button id="btn-save-quiz">Salvar e ver recomenda√ß√µes</button>
      </div>
    </section>

    <!-- Principal -->
    <section id="home" class="section">
      <div class="topbar">
        <div>
          <h2>Busca</h2>
          <p class="subtitle">Encontre suplementos com base na ci√™ncia.</p>
        </div>
        <button class="pill-btn" id="btn-premium">Seja Premium</button>
      </div>
      <div class="search-bar">
        <input id="search" type="search" placeholder="Busque por nome (ex.: Creatina)" />
        <button id="search-btn" class="search-btn" aria-label="Buscar">üîç</button>
      </div>
      <div class="select-filter">
        <select id="view-mode">
          <option value="recommended">Recomendados</option>
          <option value="popular">Populares</option>
        </select>
        <label style="display:flex;align-items:center;gap:8px;margin-top:8px;font-size:14px;">
          <input type="checkbox" id="filter-high" style="width:16px;height:16px;accent-color:var(--green);" />
          Mostrar apenas evid√™ncia alta
        </label>
      </div>
      <div class="card" style="margin-bottom:12px;" id="personal-card">
        <div class="section-title-row" style="margin-bottom:6px;">
          <div>
            <strong>Recomenda√ß√µes personalizadas</strong>
            <p class="subtitle" id="personal-summary">Defina seu perfil para priorizarmos suplementos.</p>
          </div>
          <button class="pill-btn" style="padding:8px 10px;font-size:12px;" id="btn-ajustar-perfil">Ajustar</button>
        </div>
        <div class="mini-cards" id="personal-recos"></div>
      </div>
      <div id="supplement-list"></div>
    </section>

    <!-- Detalhes -->
    <section id="details" class="section">
      <div class="detail-hero">
        <button class="pill-btn" id="btn-back-home" style="margin-bottom:10px;padding:8px 12px;">‚Üê Voltar</button>
        <img id="detail-image" alt="Imagem do suplemento" />
        <div class="title-row">
          <h2 id="detail-name"></h2>
          <div id="detail-reliability" class="badge"></div>
        </div>
        <p class="subtitle" id="detail-short"></p>
      </div>
      <div class="detail-section">
        <h3>O que √©</h3>
        <p id="detail-what" class="subtitle"></p>
      </div>
      <div class="detail-section">
        <h3>Como funciona</h3>
        <ul id="detail-how"></ul>
      </div>
      <div class="detail-section">
        <h3>Quando √© indicado</h3>
        <p id="detail-when" class="subtitle"></p>
      </div>
      <div class="detail-section">
        <h3>Cuidados</h3>
        <p id="detail-care" class="subtitle"></p>
      </div>
      <div class="detail-section">
        <h3>Fontes / Refer√™ncias</h3>
        <ul id="detail-refs"></ul>
      </div>
    </section>

    <!-- Hist√≥rico -->
    <section id="history" class="section">
      <div class="topbar">
        <h2>Hist√≥rico</h2>
        <p class="subtitle">Buscas e suplementos visualizados.</p>
      </div>
      <div class="tabs">
        <button class="tab-btn active" data-tab="searches">Pesquisa</button>
        <button class="tab-btn" data-tab="supps">Suplementos</button>
      </div>
      <div id="tab-searches" class="history-list"></div>
      <div id="tab-supps" class="history-list" style="display:none;"></div>
    </section>

    <!-- Perfil -->
    <section id="profile" class="section">
      <div class="profile-header">
        <div class="avatar">JP</div>
        <div>
          <h3 id="profile-name">Jo√£o Pedro</h3>
          <p class="subtitle" id="profile-email">usuario@email.com</p>
        </div>
      </div>
      <div class="card">
        <div class="options-list">
          <div class="option" data-option="account">Dados da conta <span>‚Ä∫</span></div>
          <div class="option" data-option="share">Compartilhe com um amigo <span>‚Ä∫</span></div>
          <div class="option" data-option="premium">Seja Premium <span>‚Ä∫</span></div>
          <div class="option" data-option="terms">Termos de uso <span>‚Ä∫</span></div>
          <div class="option" data-option="help">Ajuda e suporte <span>‚Ä∫</span></div>
        </div>
      </div>
    </section>

    <!-- C√¢mera -->
    <section id="camera" class="section">
      <div class="topbar">
        <h2>Leitura por foto</h2>
        <p class="subtitle">Abra a c√¢mera para capturar o r√≥tulo e testar.</p>
      </div>
      <div class="camera-box">
        <div class="camera-stage">
          <video id="camera-video" playsinline muted></video>
          <canvas id="camera-canvas"></canvas>
          <div class="camera-overlay"></div>
        </div>
        <div class="camera-status" id="camera-status">üéØ Toque em "Ativar c√¢mera" para tentar abrir o dispositivo.</div>
        <div class="camera-actions">
          <button id="btn-start-camera">Ativar c√¢mera</button>
          <button class="btn-secondary" id="btn-switch-camera">Alternar c√¢mera</button>
          <button class="btn-secondary" id="btn-capture">Tirar foto</button>
        </div>
      </div>
      <div class="card" style="margin-top:12px;">
        <div class="section-title-row" style="margin-bottom:8px;">
          <strong>Capturas recentes</strong>
          <span class="subtitle" style="margin:0;font-size:13px;">Guardado s√≥ no seu dispositivo</span>
        </div>
        <div id="capture-gallery" class="capture-grid">
          <div class="empty-state">Nenhuma foto capturada ainda.</div>
        </div>
      </div>
    </section>
  </div>

  <!-- Barra de navega√ß√£o -->
  <div class="navbar">
    <div class="inner">
      <button class="nav-btn" data-target="history">
        <span class="nav-icon">üïë</span>
        <span>Hist√≥rico</span>
      </button>
      <button class="nav-btn active" data-target="home">
        <span class="nav-icon">üîç</span>
        <span>Busca</span>
      </button>
      <button class="nav-btn" data-target="camera">
        <span class="nav-icon">üì∏</span>
        <span>C√¢mera</span>
      </button>
      <button class="nav-btn" data-target="chat">
        <span class="nav-icon">üí¨</span>
        <span>Chatbot</span>
      </button>
      <button class="nav-btn" data-target="profile">
        <span class="nav-icon">üë§</span>
        <span>Perfil</span>
      </button>
    </div>
  </div>

  <!-- Chatbot -->
  <section id="chat" class="section">
    <div class="chat-hero">
      <div class="section-title-row" style="align-items:flex-start;">
        <div>
          <h2 style="margin-bottom:6px;">Chatbot ComprovaFIT</h2>
          <p class="subtitle" style="margin-bottom:0;">Visual de conversa inspirado no ChatGPT para d√∫vidas sobre suplementos.</p>
        </div>
      </div>
    </div>
    <div class="card chat-wrapper">
      <div class="chat-feed" id="chat-feed"></div>
      <div class="chat-input-row">
        <input id="chat-input" type="text" placeholder="Modo demonstra√ß√£o ‚Äî converse em breve" autocomplete="off" disabled />
        <button class="chat-send" id="chat-send" aria-label="Enviar" disabled>‚û§</button>
      </div>
    </div>
  </section>

  <script>
    const sections = document.querySelectorAll('.section');
    const navButtons = document.querySelectorAll('.nav-btn[data-target]');
    const tabButtons = document.querySelectorAll('.tab-btn');
    const historySearchList = document.getElementById('tab-searches');
    const historySuppList = document.getElementById('tab-supps');
    const navbar = document.querySelector('.navbar');
    const cameraStage = document.querySelector('.camera-stage');
    const videoEl = document.getElementById('camera-video');
    const canvasEl = document.getElementById('camera-canvas');
    const cameraStatus = document.getElementById('camera-status');
    const startCameraBtn = document.getElementById('btn-start-camera');
    const switchCameraBtn = document.getElementById('btn-switch-camera');
    const captureBtn = document.getElementById('btn-capture');
    const captureGallery = document.getElementById('capture-gallery');
    const chatFeed = document.getElementById('chat-feed');

    const personaOptions = {
      objetivo: ['Ganho de massa', 'Emagrecimento', 'Desempenho', 'Sa√∫de geral', 'Energia extra', 'Recupera√ß√£o'],
      preferencias: ['Vegano/Vegetariano', 'Baixo carbo', 'Zero lactose', 'Sem cafe√≠na', 'Natural/plant based'],
      restricoes: ['Hipertens√£o', 'Diabetes', 'Gesta√ß√£o', 'Doen√ßa renal', 'Sensibilidade a cafe√≠na']
    };

    const supplements = [
      {
        id: 'creatina',
        name: 'Creatina Monohidratada',
        short: 'Aumenta for√ßa, pot√™ncia e volume muscular de forma segura.',
        reliability: 'alta',
        image: 'img/creatina.png',
        category: 'recommended',
        tags: ['desempenho', 'for√ßa', 'massa'],
        what: 'Suplemento que rep√µe estoques de fosfocreatina, acelerando a regenera√ß√£o de ATP.',
        how: ['Melhora explos√£o e velocidade.', 'Ajuda a treinar mais pesado.', 'Pode favorecer ganho de massa magra.'],
        when: 'Diariamente, com ou sem treino, para manter satura√ß√£o muscular.',
        care: 'Boa hidrata√ß√£o e acompanhamento em caso de doen√ßa renal.',
        refs: [
          { label: 'ISSN Position Stand 2022', url: 'https://jissn.biomedcentral.com/articles/10.1186/s12970-022-00491-5' },
          { label: 'Sports Medicine 2021', url: 'https://link.springer.com/article/10.1007/s40279-021-01416-z' }
        ]
      },
      {
        id: 'whey',
        name: 'Whey Protein Concentrado',
        short: 'Prote√≠na completa para recuperar e manter massa magra.',
        reliability: 'alta',
        image: 'img/whey.png',
        category: 'popular',
        tags: ['massa', 'recupera√ß√£o'],
        what: 'Derivado do soro do leite, rico em amino√°cidos essenciais e BCAAs.',
        how: ['Estimula s√≠ntese proteica.', 'Complementa ingest√£o di√°ria.', 'Pr√°tico no p√≥s-treino.'],
        when: 'P√≥s-treino ou entre refei√ß√µes para bater meta de prote√≠na.',
        care: 'Avaliar toler√¢ncia √† lactose; vers√µes isoladas t√™m menos carboidratos.',
        refs: [
          { label: 'Nutrition Journal 2021', url: 'https://nutritionj.biomedcentral.com/articles/10.1186/s12937-021-00718-1' },
          { label: 'J Appl Physiol 2017', url: 'https://journals.physiology.org/doi/full/10.1152/japplphysiol.00114.2017' }
        ]
      },
      {
        id: 'cafeina',
        name: 'Cafe√≠na Anidra',
        short: 'Melhora foco, percep√ß√£o de esfor√ßo e alerta pr√©-treino.',
        reliability: 'alta',
        image: 'img/cafeina.png',
        category: 'popular',
        tags: ['energia', 'desempenho'],
        what: 'Estimulante do sistema nervoso central com efeito ergog√™nico comprovado.',
        how: ['Diminui sensa√ß√£o de fadiga.', 'Melhora tempo de rea√ß√£o.', 'Aumenta capacidade de esfor√ßo.'],
        when: '30-45 minutos antes do treino ou provas.',
        care: 'Evitar uso noturno; aten√ß√£o a hipertens√£o e sensibilidade individual.',
        refs: [
          { label: 'ISSN Position Stand 2021', url: 'https://jissn.biomedcentral.com/articles/10.1186/s12970-020-00383-4' },
          { label: 'Eur J Sport Sci 2020', url: 'https://www.tandfonline.com/doi/full/10.1080/17461391.2020.1771645' }
        ]
      },
      {
        id: 'beta',
        name: 'Beta-Alanina',
        short: 'Tampona √°cido l√°tico e sustenta esfor√ßos intensos prolongados.',
        reliability: 'media',
        image: 'img/beta.png',
        category: 'recommended',
        tags: ['resist√™ncia', 'desempenho'],
        what: 'Amino√°cido que eleva carnosina muscular, retardando a fadiga.',
        how: ['Melhora performance em s√©ries longas.', 'Suporta treinos intervalados.', 'Reduz queima√ß√£o muscular.'],
        when: 'Uso di√°rio por pelo menos 4 semanas para satura√ß√£o.',
        care: 'Pode causar parestesia; dividir a dose ajuda.',
        refs: [
          { label: 'ISSN Beta-Alanina 2015', url: 'https://jissn.biomedcentral.com/articles/10.1186/s12970-015-0090-y' },
          { label: 'Nutrients 2021', url: 'https://www.mdpi.com/2072-6643/13/1/141' }
        ]
      },
      {
        id: 'vitd',
        name: 'Vitamina D3',
        short: 'Suporte imunol√≥gico, √≥sseo e hormonal.',
        reliability: 'alta',
        image: 'img/vitd.png',
        category: 'recommended',
        tags: ['sa√∫de', 'imunidade'],
        what: 'Nutriente essencial para metabolismo de c√°lcio e modula√ß√£o imune.',
        how: ['Auxilia densidade √≥ssea.', 'Contribui para imunidade.', 'Relacionada a fun√ß√£o muscular.'],
        when: 'Em caso de baixa exposi√ß√£o solar ou defici√™ncia comprovada.',
        care: 'Evitar mega doses sem exames; monitorar n√≠veis s√©ricos.',
        refs: [
          { label: 'Endocrine Society 2011', url: 'https://academic.oup.com/jcem/article/96/7/1911/2833671' },
          { label: 'Nutrients 2020', url: 'https://www.mdpi.com/2072-6643/12/6/1637' }
        ]
      },
      {
        id: 'omega',
        name: '√îmega-3 (EPA/DHA)',
        short: '√Åcidos graxos com a√ß√£o anti-inflamat√≥ria e cardiovascular.',
        reliability: 'alta',
        image: 'img/omega.png',
        category: 'recommended',
        tags: ['sa√∫de', 'recupera√ß√£o'],
        what: 'Gorduras essenciais obtidas de peixes ou algas, que modulam inflama√ß√£o.',
        how: ['Reduz marcadores inflamat√≥rios.', 'Auxilia recupera√ß√£o.', 'Benef√≠cios para sa√∫de card√≠aca.'],
        when: 'Uso cont√≠nuo para suporte geral e em fases de treino intenso.',
        care: 'Checar pureza e intera√ß√£o com anticoagulantes.',
        refs: [
          { label: 'AHA Science Advisory 2019', url: 'https://www.ahajournals.org/doi/10.1161/CIR.0000000000000747' },
          { label: 'Nutrients 2020', url: 'https://www.mdpi.com/2072-6643/12/11/3493' }
        ]
      },
      {
        id: 'nac',
        name: 'NAC (N-Acetilciste√≠na)',
        short: 'Antioxidante que auxilia imunidade e sa√∫de respirat√≥ria.',
        reliability: 'media',
        image: 'img/nac.png',
        category: 'popular',
        tags: ['sa√∫de', 'imunidade'],
        what: 'Precursora de glutationa, refor√ßa defesa antioxidante celular.',
        how: ['Apoia imunidade.', 'Pode reduzir sintomas respirat√≥rios.', 'Auxilia recupera√ß√£o em cargas altas.'],
        when: 'Per√≠odos de alto estresse oxidativo ou sazonalidade respirat√≥ria.',
        care: 'Consultar m√©dico se houver uso de medicamentos.',
        refs: [
          { label: 'Respiratory Medicine 2018', url: 'https://www.resmedjournal.com/article/S0954-6111(17)30353-3/fulltext' },
          { label: 'Clin Pharmacol Ther 2020', url: 'https://ascpt.onlinelibrary.wiley.com/doi/full/10.1002/cpt.1795' }
        ]
      },
      {
        id: 'bcaas',
        name: 'BCAAs 2:1:1',
        short: 'Leucina, isoleucina e valina para suporte √† recupera√ß√£o.',
        reliability: 'baixa',
        image: 'img/bcaas.png',
        category: 'popular',
        tags: ['recupera√ß√£o', 'energia'],
        what: 'Amino√°cidos de cadeia ramificada envolvidos na s√≠ntese proteica.',
        how: ['Podem reduzir percep√ß√£o de dor tardia.', 'Contribuem com ingest√£o total de amino√°cidos.', 'Alternativa para treinos em jejum.'],
        when: 'Antes ou durante treinos longos quando ingest√£o proteica √© insuficiente.',
        care: 'Efeito menor se consumo de prote√≠na di√°ria j√° √© adequado.',
        refs: [
          { label: 'JISSN 2018', url: 'https://jissn.biomedcentral.com/articles/10.1186/s12970-018-0213-3' },
          { label: 'Nutrients 2019', url: 'https://www.mdpi.com/2072-6643/11/11/2525' }
        ]
      },
      {
        id: 'electro',
        name: 'Reidratante com Eletr√≥litos',
        short: 'S√≥dio, pot√°ssio e magn√©sio para hidrata√ß√£o e contra√ß√£o muscular.',
        reliability: 'media',
        image: 'img/electro.png',
        category: 'recommended',
        tags: ['resist√™ncia', 'hidrata√ß√£o'],
        what: 'F√≥rmula para repor eletr√≥litos perdidos no suor durante treinos prolongados.',
        how: ['Mant√©m equil√≠brio h√≠drico.', 'Ajuda a prevenir c√£ibras.', 'Sustenta performance em endurance.'],
        when: 'Treinos >60 minutos ou em ambientes muito quentes.',
        care: 'Monitorar ingest√£o de s√≥dio em casos de hipertens√£o.',
        refs: [
          { label: 'ACSM Position Stand 2007', url: 'https://journals.lww.com/acsm-msse/fulltext/2007/02000/exercise_and_fluid_replacement.22.aspx' },
          { label: 'Sports Health 2020', url: 'https://journals.sagepub.com/doi/10.1177/1941738120930330' }
        ]
      },
      {
        id: 'caseina',
        name: 'Case√≠na Micelar',
        short: 'Prote√≠na de digest√£o lenta para saciedade e recupera√ß√£o noturna.',
        reliability: 'media',
        image: 'img/caseina.png',
        category: 'recommended',
        tags: ['massa', 'recupera√ß√£o'],
        what: 'Prote√≠na derivada do leite com libera√ß√£o gradual de amino√°cidos.',
        how: ['Sustenta s√≠ntese proteica durante o sono.', 'Ajuda na saciedade.', 'Suporte a manuten√ß√£o de massa magra.'],
        when: 'Antes de dormir ou em longos per√≠odos sem refei√ß√µes.',
        care: 'Checar toler√¢ncia √† lactose e alergias a latic√≠nios.',
        refs: [
          { label: 'Nutrients 2019', url: 'https://www.mdpi.com/2072-6643/11/10/2250' },
          { label: 'Br J Nutr 2012', url: 'https://www.cambridge.org/core/journals/british-journal-of-nutrition/article/protein-ingestion-before-sleep/660D61B0E2C6C8D6B4F4C1D893A8B236' }
        ]
      },
      {
        id: 'glutamina',
        name: 'Glutamina',
        short: 'Amino√°cido ligado √† sa√∫de intestinal e recupera√ß√£o imunol√≥gica.',
        reliability: 'baixa',
        image: 'img/glutamina.png',
        category: 'popular',
        tags: ['sa√∫de', 'recupera√ß√£o'],
        what: 'Amino√°cido abundante que serve de combust√≠vel para c√©lulas intestinais e imunes.',
        how: ['Pode reduzir sintomas gastrointestinais em treinos longos.', 'Suporta imunidade em per√≠odos de estresse.', 'Ajuda em recupera√ß√£o p√≥s-cir√∫rgica.'],
        when: 'Atletas de endurance prolongado ou recupera√ß√£o hospitalar orientada.',
        care: 'Evid√™ncia esportiva limitada; seguir orienta√ß√£o profissional.',
        refs: [
          { label: 'Nutrients 2018', url: 'https://www.mdpi.com/2072-6643/10/6/761' },
          { label: 'Front Physiol 2020', url: 'https://www.frontiersin.org/articles/10.3389/fphys.2020.00131/full' }
        ]
      },
      {
        id: 'ashwagandha',
        name: 'Ashwagandha (KSM-66)',
        short: 'Adapt√≥geno que pode auxiliar controle de estresse e desempenho.',
        reliability: 'media',
        image: 'img/ashwagandha.png',
        category: 'recommended',
        tags: ['energia', 'sa√∫de'],
        what: 'Extrato de Withania somnifera com potencial de reduzir cortisol e fadiga.',
        how: ['Pode melhorar VO2m√°x em praticantes de endurance.', 'Auxilia percep√ß√£o de estresse.', 'Suporte a qualidade do sono.'],
        when: 'Uso di√°rio por 6-8 semanas para avaliar resposta.',
        care: 'Consultar se houver uso de ansiol√≠ticos/hipotensores.',
        refs: [
          { label: 'J Int Soc Sports Nutr 2015', url: 'https://jissn.biomedcentral.com/articles/10.1186/s12970-015-0104-9' },
          { label: 'Medicine 2020', url: 'https://journals.lww.com/md-journal/fulltext/2020/11250/efficacy_and_safety_of_ashwagandha__a.74.aspx' }
        ]
      },
      {
        id: 'colageno',
        name: 'Col√°geno Tipo II + Vitamina C',
        short: 'Suporte articular para quem sente desconforto em treinos.',
        reliability: 'media',
        image: 'img/colageno.png',
        category: 'popular',
        tags: ['sa√∫de', 'recupera√ß√£o'],
        what: 'Pept√≠deos de col√°geno espec√≠ficos para cartilagem associados √† vitamina C.',
        how: ['Pode reduzir dores articulares leves.', 'Fornece amino√°cidos para matriz cartilaginosa.', 'Vitamina C apoia s√≠ntese de col√°geno.'],
        when: 'Uso di√°rio por 3-6 meses em combina√ß√£o com fortalecimento.',
        care: 'Evid√™ncia moderada; manter treinamento de suporte articular.',
        refs: [
          { label: 'Curr Med Res Opin 2008', url: 'https://www.tandfonline.com/doi/full/10.1185/030079908X280707' },
          { label: 'Nutrients 2021', url: 'https://www.mdpi.com/2072-6643/13/7/2276' }
        ]
      }
    ];


    let navReady = false;
    let userProfile = {
      email: '',
      idade: '',
      peso: '',
      atividade: 'Moderado',
      exercicio: '',
      objetivo: '',
      preferencias: [],
      restricoes: []
    };

    let historySupplements = [];
    let historySearches = [];
    let currentSupplement = null;
    let lastSearchTerm = '';
    let cameraStream = null;
    let currentFacing = 'environment';
    const capturedPhotos = [];
    const STATE_KEY = 'comprovafit-state-v2';

    // ---------- Estado persistente ----------
    function saveState() {
      try {
        const payload = {
          userProfile,
          historySupplements,
          historySearches,
          navReady
        };
        localStorage.setItem(STATE_KEY, JSON.stringify(payload));
      } catch (err) {
        console.warn('N√£o foi poss√≠vel salvar o estado', err);
      }
    }

    function loadState() {
      try {
        const data = localStorage.getItem(STATE_KEY);
        if (!data) return;
        const parsed = JSON.parse(data);
        userProfile = { ...userProfile, ...(parsed.userProfile || {}) };
        historySupplements = parsed.historySupplements || [];
        historySearches = parsed.historySearches || [];
        navReady = !!parsed.navReady;
      } catch (err) {
        console.warn('N√£o foi poss√≠vel carregar o estado', err);
      }
    }

    function showSection(id) {
      sections.forEach(sec => {
        sec.classList.toggle('active', sec.id === id);
      });
      navButtons.forEach(btn => {
        const target = btn.getAttribute('data-target');
        btn.classList.toggle('active', target === id);
      });
      updateNavVisibility(id);
      if (id !== 'camera') {
        stopCamera();
      }
      if (id === 'camera') {
        updateSwitchLabel();
      }
      if (id === 'persona') {
        renderPersonaChips();
        updatePersonaSuggestions();
      }
    }

    function hydrateProfileInputs() {
      document.getElementById('login-email').value = userProfile.email || '';
      document.getElementById('idade').value = userProfile.idade || '';
      document.getElementById('peso').value = userProfile.peso || '';
      document.getElementById('atividade').value = userProfile.atividade || 'Moderado';
      document.getElementById('exercicio').value = userProfile.exercicio || '';
      document.getElementById('objetivo').value = userProfile.objetivo || '';
      document.getElementById('profile-email').textContent = userProfile.email || 'usuario@email.com';
      document.getElementById('profile-name').textContent = userProfile.exercicio || 'Jo√£o Pedro';
    }

    function updateNavVisibility(currentId) {
      const showNav = navReady && !['login', 'persona', 'quiz'].includes(currentId);
      navbar.classList.toggle('show', showNav);
      document.body.classList.toggle('nav-active', showNav);
    }

    function reliabilityBadge(level) {
      if (level === 'alta') return 'Alta';
      if (level === 'media') return 'Moderada';
      return 'Baixa';
    }

    function reliabilityClass(level) {
      if (level === 'alta') return 'reliability-high';
      if (level === 'media') return 'reliability-medium';
      return 'reliability-low';
    }

    function renderStaticChat() {
      if (!chatFeed) return;
      chatFeed.innerHTML = `
        <div class="chat-bubble user">Quais suplementos t√™m mais evid√™ncia para for√ßa?</div>
        <div class="chat-bubble bot">Recomendo come√ßar por creatina (evid√™ncia alta) e whey protein para suporte de prote√≠na di√°ria. Ambos t√™m bons estudos controlados e s√£o seguros para a maioria das pessoas saud√°veis.</div>
      `;
    }

    // Calcula prioriza√ß√£o de suplementos considerando objetivo, treino e restri√ß√µes
    function computeScore(supp) {
      let score = 0;
      const objetivo = (userProfile.objetivo || '').toLowerCase();
      const objectiveMap = {
        massa: ['massa', 'hipertrofia', 'for√ßa'],
        emagrecimento: ['emagrec', 'defini', 'peso'],
        desempenho: ['desempenho', 'performance', 'veloc'],
        'sa√∫de geral': ['sa√∫de', 'bem-estar', 'imun'],
        energia: ['energia', 'foco', 'alerta'],
        recupera√ß√£o: ['recupera√ß√£o', 'hidrata√ß√£o', 'anti-inflamat']
      };

      Object.entries(objectiveMap).forEach(([key, keywords]) => {
        if (keywords.some(k => objetivo.includes(k))) {
          if (supp.tags.some(t => (key === 'energia' ? 'energia' : key).includes(t) || t.includes(key.replace(' ', '')))) {
            score += 3;
          }
          if (supp.short.toLowerCase().includes(key.split(' ')[0])) score += 1;
        }
      });

      if (userProfile.atividade === 'Intenso' && supp.tags.includes('resist√™ncia')) score += 2;
      if (userProfile.exercicio?.toLowerCase().includes('corrida') && supp.tags.includes('resist√™ncia')) score += 1;
      if (userProfile.exercicio?.toLowerCase().includes('muscul') && supp.tags.includes('massa')) score += 1;

      if (userProfile.preferencias.includes('Sem cafe√≠na') || userProfile.restricoes.includes('Sensibilidade a cafe√≠na')) {
        if (supp.id === 'cafeina') score -= 5;
      }
      if (userProfile.restricoes.includes('Doen√ßa renal') && supp.id === 'creatina') score -= 4;
      if (userProfile.preferencias.includes('Zero lactose') && supp.id === 'whey') score -= 3;
      if (userProfile.restricoes.includes('Hipertens√£o') && supp.id === 'cafeina') score -= 3;

      if (supp.category === 'recommended') score += 1;
      return score;
    }

    function renderList() {
      const listEl = document.getElementById('supplement-list');
      const term = document.getElementById('search').value.toLowerCase().trim();
      const mode = document.getElementById('view-mode').value;
      const highOnly = document.getElementById('filter-high').checked;
      const personalCard = document.getElementById('personal-card');

      if (personalCard) {
        personalCard.style.display = term ? 'none' : 'block';
      }

      let filtered = supplements.filter(s => {
        const haystack = `${s.name} ${s.short} ${s.what} ${s.tags.join(' ')}`.toLowerCase();
        const matchesTerm = term ? haystack.includes(term) : true;
        const matchesReliability = highOnly ? s.reliability === 'alta' : true;
        return matchesTerm && matchesReliability;
      });

      filtered = filtered.sort((a, b) => computeScore(b) - computeScore(a));

      if (mode === 'popular') {
        filtered = filtered.filter(s => s.category === 'popular').concat(
          filtered.filter(s => s.category !== 'popular')
        );
      }

      if (!filtered.length) {
        listEl.innerHTML = '<div class="empty-state">Nenhum suplemento encontrado para essa busca.</div>';
        return;
      }

      listEl.innerHTML = filtered.map(supp => `
        <div class="supplement-item" data-id="${supp.id}">
          <img src="${supp.image}" alt="${supp.name}" />
          <div class="supplement-info">
            <h4>${supp.name}</h4>
            <p>${supp.short}</p>
          </div>
          <div class="badge ${reliabilityClass(supp.reliability)}">${reliabilityBadge(supp.reliability)}</div>
        </div>
      `).join('');

      listEl.querySelectorAll('.supplement-item').forEach(item => {
        item.addEventListener('click', () => {
          const sup = supplements.find(s => s.id === item.dataset.id);
          openDetails(sup);
          addHistorySupplement(sup);
        });
      });
    }

    function updatePersonalRecos() {
      const target = document.getElementById('personal-recos');
      const summary = document.getElementById('personal-summary');
      const scored = [...supplements].sort((a, b) => computeScore(b) - computeScore(a));
      const topThree = scored.slice(0, 3);

      if (!userProfile.objetivo && !userProfile.preferencias.length && !userProfile.restricoes.length) {
        summary.textContent = 'Defina seu perfil para priorizarmos suplementos.';
      } else {
        const parts = [];
        if (userProfile.objetivo) parts.push(`foco em ${userProfile.objetivo}`);
        if (userProfile.preferencias.length) parts.push(`prefer√™ncias: ${userProfile.preferencias.join(', ')}`);
        if (userProfile.restricoes.length) parts.push(`restri√ß√µes: ${userProfile.restricoes.join(', ')}`);
        summary.textContent = `Recomendamos primeiro com ${parts.join(' | ')}`;
      }

      target.innerHTML = topThree.map(s => `
        <div class="mini-card">
          <div style="display:flex;align-items:center;gap:8px;">
            <img src="${s.image}" alt="${s.name}" style="width:48px;height:48px;border-radius:14px;object-fit:cover;" />
            <div>
              <strong>${s.name}</strong>
              <p class="subtitle" style="margin:0;">${reliabilityBadge(s.reliability)}</p>
            </div>
          </div>
          <p class="subtitle" style="margin:0;">${s.short}</p>
        </div>
      `).join('');
    }

    function renderPersonaChips() {
      const buildChoices = (containerId, type, multiple = false) => {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        const groupName = multiple ? `${type}-group` : 'objetivo-group';

        personaOptions[type].forEach(opt => {
          const row = document.createElement('div');
          row.className = 'choice-item';

          const input = document.createElement('input');
          input.type = multiple ? 'checkbox' : 'radio';
          input.name = groupName;
          input.value = opt;
          input.checked = multiple ? userProfile[type].includes(opt) : userProfile[type] === opt;

          const check = document.createElement('span');
          check.className = 'choice-check';
          check.textContent = '‚úì';

          const label = document.createElement('span');
          label.className = 'choice-label';
          label.textContent = opt;

          const syncSelection = (isSelected) => {
            row.classList.toggle('selected', isSelected);
            check.style.color = isSelected ? 'var(--green)' : 'transparent';
          };

          syncSelection(input.checked);

          const handleSelect = () => {
            if (multiple) {
              const set = new Set(userProfile[type]);
              if (set.has(opt)) {
                set.delete(opt);
                input.checked = false;
              } else {
                set.add(opt);
                input.checked = true;
              }
              userProfile[type] = [...set];
            } else {
              userProfile[type] = opt;
              document.getElementById('objetivo').value = opt;
              container.querySelectorAll('.choice-item').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('.choice-check').style.color = 'transparent';
              });
              input.checked = true;
            }
            syncSelection(input.checked);
            updatePersonaSuggestions();
          };

          row.addEventListener('click', handleSelect);
          input.addEventListener('change', handleSelect);

          row.appendChild(input);
          row.appendChild(check);
          row.appendChild(label);
          container.appendChild(row);
        });
      };

      buildChoices('chip-objetivo', 'objetivo', false);
      buildChoices('chip-preferencias', 'preferencias', true);
      buildChoices('chip-restricoes', 'restricoes', true);
    }

    function updatePersonaSuggestions() {
      updatePersonalRecos();
      saveState();
    }

    function addHistorySupplement(sup) {
      historySupplements = [sup, ...historySupplements.filter(h => h.id !== sup.id)].slice(0, 15);
      updateHistoryUI();
      saveState();
    }

    function addSearchTerm(term) {
      if (!term || term === lastSearchTerm) return;
      lastSearchTerm = term;
      historySearches = [term, ...historySearches.filter(t => t !== term)].slice(0, 15);
      updateHistoryUI();
      saveState();
    }

    function setCameraStatus(message, isError = false) {
      if (!cameraStatus) return;
      cameraStatus.textContent = message;
      cameraStatus.style.color = isError ? '#c63d2f' : 'var(--gray)';
      cameraStatus.classList.toggle('capture-feedback', !isError && message.toLowerCase().includes('capturada'));
    }

    function updateSwitchLabel() {
      if (!switchCameraBtn) return;
      const label = currentFacing === 'environment' ? 'Usar c√¢mera frontal' : 'Usar c√¢mera traseira';
      switchCameraBtn.textContent = label;
    }

    function renderCapturedPhotos() {
      if (!captureGallery) return;
      if (!capturedPhotos.length) {
        captureGallery.innerHTML = '<div class="empty-state">Nenhuma foto capturada ainda.</div>';
        return;
      }
      captureGallery.innerHTML = capturedPhotos.map(item => `
        <div class="capture-card">
          <img class="capture-thumb" src="${item.src}" alt="Captura da c√¢mera" />
          <div class="capture-meta">
            <span>${item.facing === 'environment' ? 'Traseira' : 'Frontal'}</span>
            <span>${item.time}</span>
          </div>
        </div>
      `).join('');
    }

    // --- C√¢mera: controle de lifecycle ---
    function stopCamera() {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
      }
      cameraStream = null;
      if (videoEl) {
        videoEl.srcObject = null;
        videoEl.style.display = 'block';
      }
      if (canvasEl) {
        canvasEl.style.display = 'none';
      }
      cameraStage?.classList.remove('flash');
    }

    async function startCamera() {
      if (!videoEl || !canvasEl) return;
      canvasEl.style.display = 'none';
      videoEl.style.display = 'block';

      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        setCameraStatus('C√¢mera n√£o suportada neste navegador/dispositivo.', true);
        return;
      }

      try {
        stopCamera();
        const constraints = { video: { facingMode: { ideal: currentFacing } } };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        cameraStream = stream;
        videoEl.srcObject = stream;
        await videoEl.play();
        setCameraStatus(`C√¢mera ${currentFacing === 'environment' ? 'traseira' : 'frontal'} ativa. Centralize o r√≥tulo na moldura e toque em "Tirar foto".`);
      } catch (err) {
        if (currentFacing === 'environment') {
          currentFacing = 'user';
          updateSwitchLabel();
          setCameraStatus('N√£o foi poss√≠vel usar a c√¢mera traseira, tentando a frontal...', true);
          return startCamera();
        }
        const httpsHint = location.protocol !== 'https:' && location.hostname !== 'localhost'
          ? ' Este recurso precisa de HTTPS ou localhost para funcionar em navegadores modernos.'
          : '';
        setCameraStatus(`N√£o foi poss√≠vel acessar a c√¢mera. ${err?.message || ''}${httpsHint}`, true);
      }
    }

    function capturePhoto() {
      if (!videoEl || !canvasEl) return;
      if (!cameraStream) {
        setCameraStatus('Ative a c√¢mera antes de capturar.', true);
        return;
      }
      if (!videoEl.videoWidth || !videoEl.videoHeight) {
        setCameraStatus('Aguardando v√≠deo iniciar para capturar.', true);
        return;
      }
      canvasEl.width = videoEl.videoWidth;
      canvasEl.height = videoEl.videoHeight;
      const ctx = canvasEl.getContext('2d');
      ctx.drawImage(videoEl, 0, 0, canvasEl.width, canvasEl.height);
      canvasEl.style.display = 'block';
      videoEl.style.display = 'none';
      const dataUrl = canvasEl.toDataURL('image/png');
      capturedPhotos.unshift({
        src: dataUrl,
        facing: currentFacing,
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      });
      if (capturedPhotos.length > 12) capturedPhotos.pop();
      renderCapturedPhotos();
      cameraStage?.classList.add('flash');
      setTimeout(() => cameraStage?.classList.remove('flash'), 320);
      setCameraStatus('Foto capturada localmente (n√£o √© enviada para o servidor).');
    }

    function openDetails(supp) {
      currentSupplement = supp;
      document.getElementById('detail-image').src = supp.image;
      document.getElementById('detail-name').textContent = supp.name;
      const badge = document.getElementById('detail-reliability');
      badge.textContent = reliabilityBadge(supp.reliability);
      badge.className = `badge ${reliabilityClass(supp.reliability)}`;
      document.getElementById('detail-short').textContent = supp.short;
      document.getElementById('detail-what').textContent = supp.what;
      const howList = document.getElementById('detail-how');
      howList.innerHTML = supp.how.map(item => `<li>${item}</li>`).join('');
      document.getElementById('detail-when').textContent = supp.when;
      document.getElementById('detail-care').textContent = supp.care;
      const refList = document.getElementById('detail-refs');
      refList.innerHTML = supp.refs.map(ref => `<li><a href="${ref.url}" target="_blank" rel="noopener noreferrer">üîó ${ref.label}</a></li>`).join('');
      showSection('details');
    }

    function updateHistoryUI() {
      historySearchList.innerHTML = historySearches.length
        ? historySearches.map(term => `<div class="card">üîç ${term}</div>`).join('')
        : '<div class="empty-state">Nenhuma pesquisa ainda.</div>';

      historySuppList.innerHTML = historySupplements.length
        ? historySupplements.map(s => `
          <div class="history-item">
            <img src="${s.image}" alt="${s.name}" />
            <div>
              <strong>${s.name}</strong>
              <p class="subtitle">${s.short}</p>
            </div>
            <div class="badge ${reliabilityClass(s.reliability)}">${reliabilityBadge(s.reliability)}</div>
          </div>
        `).join('')
        : '<div class="empty-state">Nenhum suplemento visualizado.</div>';
    }

    document.getElementById('btn-login').addEventListener('click', () => {
      const email = document.getElementById('login-email').value.trim();
      userProfile.email = email || 'usuario@comprovafit.com';
      document.getElementById('profile-email').textContent = userProfile.email;
      saveState();
      showSection('persona');
    });

    document.getElementById('btn-guest').addEventListener('click', () => {
      showSection('persona');
    });

    document.getElementById('btn-go-quiz').addEventListener('click', () => {
      showSection('quiz');
    });

    document.getElementById('btn-save-quiz').addEventListener('click', () => {
      userProfile = {
        ...userProfile,
        idade: document.getElementById('idade').value,
        peso: document.getElementById('peso').value,
        atividade: document.getElementById('atividade').value,
        exercicio: document.getElementById('exercicio').value,
        objetivo: document.getElementById('objetivo').value,
      };
      navReady = true;
      document.getElementById('profile-name').textContent = userProfile.exercicio || 'Jo√£o Pedro';
      updatePersonaSuggestions();
      renderList();
      saveState();
      showSection('home');
    });

    document.getElementById('btn-ajustar-perfil').addEventListener('click', () => {
      showSection('persona');
    });

    document.getElementById('btn-back-home').addEventListener('click', () => {
      showSection('home');
    });

    document.getElementById('btn-premium').addEventListener('click', () => {
      alert('Planos premium em desenvolvimento.');
    });

    function handleSearchSubmit() {
      const term = document.getElementById('search').value.trim();
      if (term) addSearchTerm(term);
      renderList();
    }

    document.getElementById('search').addEventListener('input', () => {
      renderList();
    });

    document.getElementById('search').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        handleSearchSubmit();
      }
    });

    document.getElementById('search-btn').addEventListener('click', handleSearchSubmit);

    document.getElementById('view-mode').addEventListener('change', renderList);
    document.getElementById('filter-high').addEventListener('change', renderList);

    startCameraBtn?.addEventListener('click', startCamera);
    captureBtn?.addEventListener('click', capturePhoto);
    switchCameraBtn?.addEventListener('click', () => {
      currentFacing = currentFacing === 'environment' ? 'user' : 'environment';
      updateSwitchLabel();
      startCamera();
    });

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');
        if (target) {
          showSection(target);
        }
      });
    });

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.getElementById('tab-searches').style.display = tab === 'searches' ? 'flex' : 'none';
        document.getElementById('tab-supps').style.display = tab === 'supps' ? 'flex' : 'none';
      });
    });

    document.querySelectorAll('.option').forEach(opt => {
      opt.addEventListener('click', () => alert('Recurso em desenvolvimento.'));
    });

    // Chat em modo demonstra√ß√£o
    renderStaticChat();

    // Inicializa√ß√£o
    loadState();
    hydrateProfileInputs();
    renderPersonaChips();
    updatePersonaSuggestions();
    updateHistoryUI();
    renderList();
    renderCapturedPhotos();
    updateSwitchLabel();
    document.getElementById('tab-supps').style.display = 'none';

    if (navReady) {
      showSection('home');
    } else {
      showSection('login');
    }
  </script>
</body>
</html>
